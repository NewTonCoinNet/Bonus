import os
import asyncio
import aiogram.utils
from aiogram import Bot, Dispatcher, F, types
from aiogram.filters import CommandStart, Command
from aiogram.filters.command import Command 
from aiogram.types import Message, CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.client.session.aiohttp import AiohttpSession
from dotenv import load_dotenv
from random import choice

load_dotenv()

session = os.getenv('session = session')
session = AiohttpSession(proxy='http://proxy.server:3128')
bot = Bot(token='TOKEN', session = session, proxy="http://proxy.server:3128" )
TOKEN = os.getenv('TOKEN')
dp = Dispatcher()

# –°–ø–∏—Å–æ–∫ —É–ª–∏—Ü –¥–ª—è –≤—ã–±–æ—Ä–∞
STREET_LIST = [
   "1 –ú–∞—è  ",
    "1342 –∫–º —Ä–∞–∑—ä–µ–∑–¥",
    "1352 –∫–º —Ä–∞–∑—ä–µ–∑–¥",
    "2-–π –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω",
    "60 –ª–µ—Ç –î–û–°–ê–ê–§  ",
    "8 –ú–∞—Ä—Ç–∞  ",
    "–ê–≤—Ç–æ–º–æ–±–∏–ª–∏—Å—Ç–æ–≤  ",
    "–ê–∫–∏–º–æ–≤–∞  ",
    "–ê–∫—Å–∞–∫–æ–≤–∞  ",
    "–ê–ª—Ç–∞–π—Å–∫–∞—è  ",
    "–ë–µ–∑—ã–º—è–Ω–Ω–∞—è  ",
    "–ë–µ—Ä–µ–∑–æ–≤–∞—è  ",
    "–ë–æ–ª—å–Ω–∏—á–Ω–∞—è  ",
    "–ë—Ä–æ–Ω–Ω–∞—è  ",
    "–ë—É–≥—É–ª—å–º–∏–Ω—Å–∫–∞—è  ",
    "–ë—É–≥—É—Ä—É—Å–ª–∞–Ω—Å–∫–∞—è  ",
    "–ë—É–∑—É–ª—É–∫—Å–∫–∞—è  ",
    "–í–µ—Ä–Ω–∞–¥—Å–∫–æ–≥–æ  ",
    "–í–æ–¥–æ–∫–∞—á–µ—á–Ω–∞—è  ",
    "–í–æ–∑–Ω–µ—Å–µ–Ω—Å–∫–æ–≥–æ  ",
    "–í–æ–π–∫–æ–≤–∞  ",
    "–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è  ",
    "–í–æ–ª–æ–¥–∞—Ä—Å–∫–æ–≥–æ  ",
    "–í–æ—Ä–æ—à–∏–ª–æ–≤–∞  ",
    "–í–æ—Å—Ç–æ—á–Ω—ã–π –ø–µ—Ä–µ—É–ª–æ–∫",
    "–í—ã—Å–æ—Ç–Ω–∞—è  ",
    "–ì–∞–≥–∞—Ä–∏–Ω–∞  ",
    "–ì–∞—è  ",
    "–ì–µ–æ–ª–æ–≥–æ–≤  ",
    "–ì–µ—Ä—Ü–µ–Ω–∞  ",
    "–ì–ª–∏–Ω–∫–∏  ",
    "–ì–æ–≥–æ–ª—è  ",
    "–ì—Ä–µ—á—É—à–∫–∏–Ω–∞  ",
    "–î–∞—á–Ω–∞—è  ",
    "–î–∑–µ—Ä–∂–∏–Ω—Å–∫–æ–≥–æ  ",
    "–î–Ω–µ–ø—Ä–æ–≤—Å–∫–æ–π –î–∏–≤–∏–∑–∏–∏  ",
    "–î–æ—Å—Ç–æ–µ–≤—Å–∫–æ–≥–æ  ",
    "–ï—Å–µ–Ω–∏–Ω–∞  ",
    "–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω–∞—è  ",
    "–ñ–µ–º—á—É–∂–Ω–∞—è  ",
    "–ñ—É–∫–æ–≤–∞  ",
    "–ó–∞–≤–æ–¥—Å–∫–∞—è  ",
    "–ó–∞–æ–∑–µ—Ä–Ω–∞—è  ",
    "–ó–≤–µ–∑–¥–Ω–∞—è  ",
    "–ó–µ–ª–µ–Ω–∞—è  ",
    "–ó—É–π–∫–æ–≤–∞  ",
    "–ò–∑—É–º—Ä—É–¥–Ω–∞—è  ",
    "–ò–ª–µ–∫—Å–∫–∞—è  ",
    "–ò–ª–µ—Ü–∫–∞—è  ",
    "–ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è  ",
    "–ò—Ä–∫—É—Ç—Å–∫–∞—è  ",
    "–ö–∞–∑–∞–∫–æ–≤–∞  ",
    "–ö–∞–ª–∏–Ω–∏–Ω–∞  ",
    "–ö–∞—Ä–ª–∞ –ú–∞—Ä–∫—Å–∞  ",
    "–ö–∏–µ–≤—Å–∫–∞—è  ",
    "–ö–ª–µ–Ω–æ–≤–∞—è  ",
    "–ö–æ–ª—Ö–æ–∑–Ω–∞—è  ",
    "–ö–æ–º–∞—Ä–æ–≤–∞  ",
    "–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∞—è  ",
    "–ö–æ–Ω–æ–≤–∞–ª–æ–≤–∞  ",
    "–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è  ",
    "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è  ",
    "–ö–æ—Ç–æ–≤—Å–∫–æ–≥–æ  ",
    "–ö—Ä–∞—Å–Ω–æ–∞—Ä–º–µ–π—Å–∫–∞—è  ",
    "–ö—Ä–∞—Å–Ω–æ–≥–≤–∞—Ä–¥–µ–π—Å–∫–∞—è  ",
    "–ö—Ä–µ—Å—Ç—å—è–Ω—Å–∫–∞—è  ",
    "–ö—Ä—É–ø—Å–∫–∞—è  ",
    "–ö—Ä—ã–ª–æ–≤–∞  ",
    "–ö—É–π–±—ã—à–µ–≤–∞  ",
    "–ö—É—Ä—Å–∫–∞—è  ",
    "–ö—É—Ç—É–∑–æ–≤–∞  ",
    "–õ–∞–≤–∫–æ–≤–∞  ",
    "–õ–µ–Ω–∏–Ω–∞  ",
    "–õ–µ—Ä–º–æ–Ω—Ç–æ–≤–∞  ",
    "–õ–µ—Å–∫–æ–≤–∞  ",
    "–õ–æ–º–æ–Ω–æ—Å–æ–≤–∞  ",
    "–õ–æ—à–∫–æ–≤–∞  ",
    "–õ—É–≥–æ–≤–∞—è  ",
    "–õ—É–Ω–∞—á–∞—Ä—Å–∫–æ–≥–æ  ",
    "–õ—å–≤–∞ –¢–æ–ª—Å—Ç–æ–≥–æ  ",
    "–ú–∞–≥–∏—Å—Ç—Ä–∞–ª—å–Ω–∞—è  ",
    "–ú–∞–∫—Å–∏–º–∞ –ì–æ—Ä—å–∫–æ–≥–æ  ",
    "–ú–∞–Ω—å—è—à–µ–Ω—Å–∫–∞—è  ",
    "–ú–∞—Ç—Ä–æ—Å–æ–≤–∞  ",
    "–ú–∞—Ö–º—É–¥–æ–≤–∞  ",
    "–ú–∞—è–∫–æ–≤—Å–∫–æ–≥–æ  ",
    "–ú–µ–ª—å–∑–∞–≤–æ–¥ -10  ",
    "–ú–µ–ª—å–∫–æ–º–±–∏–Ω–∞—Ç  ",
    "–ú–µ–ª—å–Ω–∏—á–Ω–∞—è  ",
    "–ú–µ–Ω–¥–µ–ª–µ–µ–≤–∞  ",
    "–ú–∏–Ω—Å–∫–∞—è  ",
    "–ú–∏—Ä–∞  ",
    "–ú–∏—Ä–Ω—ã–π –ø–µ—Ä–µ—É–ª–æ–∫",
    "–ú–∏—á—É—Ä–∏–Ω–∞  ",
    "–ú–æ–ª–æ–¥–µ–∂–Ω–∞—è  ",
    "–ú–æ—Ä–æ–∑–æ–≤–∞  ",
    "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è  ",
    "–ú—É—Å—ã –î–∂–∞–ª–∏–ª—è  ",
    "–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è  ",
    "–ù–∞–±–æ–∫–æ–≤–∞  ",
    "–ù–∞–≥–æ—Ä–Ω–∞—è  ",
    "–ù–µ–≤—Å–∫–∞—è  ",
    "–ù–µ–≥–ª–∏–Ω–Ω–∞—è  ",
    "–ù–µ–∫—Ä–∞—Å–æ–≤–∞  ",
    "–ù–µ—Ñ—Ç—è–Ω–∏–∫–æ–≤  ",
    "–ù–µ—Ñ—Ç—è–Ω–∏–∫–æ–≤ –±—É–ª—å–≤–∞—Ä",
    "–ù–æ–≤–∞—è  ",
    "–ù–æ–≤—ã–π –ø–µ—Ä–µ—É–ª–æ–∫",
    "–û–∫—Ç—è–±—Ä—å—Å–∫–∞—è  ",
    "–û–º—Å–∫–∞—è  ",
    "–û—Ä–¥–∂–æ–Ω–∏–∫–∏–¥–∑–µ  ",
    "–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è  ",
    "–û—Ä–ª–æ–≤—Å–∫–∞—è  ",
    "–û—Ä—Å–∫–∞—è  ",
    "–û—Å—Ç—Ä–æ–≤—Å–∫–æ–≥–æ  ",
    "–ü–∞–Ω–æ–≤—Å–∫–∞—è  ",
    "–ü–∞—Ä–∫–æ–≤—ã–π –ø—Ä–æ—Å–ø–µ–∫—Ç",
    "–ü–∞—Ä—Ç–∏–∑–∞–Ω—Å–∫–∞—è  ",
    "–ü–∏–æ–Ω–µ—Ä—Å–∫–∞—è  ",
    "–ü–ª–µ—Ö–∞–Ω–æ–≤–∞  ",
    "–ü–ª–µ—à–∞–Ω–æ–≤—Å–∫–∞—è  ",
    "–ü–æ–±–µ–¥—ã  ",
    "–ü–æ–ª–µ–≤–∞—è  ",
    "–ü–æ—á—Ç–æ–≤–∞—è  ",
    "–ü—Ä–∏–≤–æ–∫–∑–∞–ª—å–Ω–∞—è  ",
    "–ü—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∞—è  ",
    "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è  ",
    "–ü—É–≥–∞—á–µ–≤–∞  ",
    "–ü—É—à–∫–∏–Ω–∞  ",
    "–ü—è—Ç–∏–≥–æ—Ä—Å–∫–∞—è  ",
    "–†–µ—á–Ω–∞—è  ",
    "–†–æ–∫–æ—Å—Å–æ–≤—Å–∫–æ–≥–æ  ",
    "–†—è–±–∏–Ω–æ–≤–∞—è  ",
    "–°–∞–¥–æ–≤–∞—è  ",
    "–°–∞–º–∞—Ä—Å–∫–∞—è  ",
    "–°–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è  ",
    "–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è  ",
    "–°–µ–≤–µ—Ä–Ω–∞—è  ",
    "–°–∏–¥–æ—Ä–æ–≤–Ω–∏–Ω–∞  ",
    "–°–∏—Ä–µ–Ω–µ–≤–∞—è  ",
    "–°–æ–≤–µ—Ç—Å–∫–∞—è  ",
    "–°–æ–∫–æ–ª–∏–Ω–∞—è  ",
    "–°–æ–ª–Ω–µ—á–Ω–∞—è  ",
    "–°—Ç–∞—Ä–æ—ç–ª–µ–≤–∞—Ç–æ—Ä—Å–∫–∞—è  ",
    "–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è  ",
    "–°—É–≤–æ—Ä–æ–≤–∞  ",
    "–¢–∞—à–∫–µ–Ω—Ç—Å–∫–∞—è  ",
    "–¢–∞—à–ª–∏–Ω—Å–∫–∞—è  ",
    "–¢–≤–µ—Ä—Å–∫–∞—è  ",
    "–¢–∏–º–∏—Ä—è–∑–µ–≤–∞  ",
    "–¢–æ–º—Å–∫–∞—è  ",
    "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è  ",
    "–¢—É—Ä–≥–µ–Ω–µ–≤–∞  ",
    "–£—Ä–∞–ª—å—Å–∫–∞—è  ",
    "–£—Ä–∞–Ω–æ–≤–∞—è  ",
    "–£—Å—Ç–∏–Ω–æ–≤–∞  ",
    "–£—à–∞–∫–æ–≤–∞  ",
    "–§–∞–¥–µ–µ–≤–∞  ",
    "–§—Ä–∏–¥—Ä–∏—Ö–∞ –≠–Ω–≥–µ–ª—å—Å–∞  ",
    "–§—Ä—É–Ω–∑–µ  ",
    "–§—É—Ä–º–∞–Ω–æ–≤–∞  ",
    "–•–∞–±–∞—Ä–æ–≤—Å–∫–∞—è  ",
    "–•–ª–µ–±–Ω–∞—è  ",
    "–¶–≤–µ—Ç–æ—á–Ω–∞—è  ",
    "–¶–∏–æ–ª–∫–æ–≤—Å–∫–æ–≥–æ  ",
    "–ß–∞–π–∫–æ–≤—Å–∫–æ–≥–æ  ",
    "–ß–∞–ø–∞–µ–≤–∞  ",
    "–ß–µ—Ä–Ω—ã—à–µ–≤—Å–∫–æ–≥–æ  ",
    "–ß–µ—Ö–æ–≤–∞  ",
    "–ß–∫–∞–ª–æ–≤–∞  ",
    "–®–∞—Ç–∞–ª–æ–≤–∞  ",
    "–®–∫–æ–ª—å–Ω—ã–π  ",
    "–®–æ–ª–æ—Ö–æ–≤–∞  ",
    "–®–æ—Å—Å–µ–π–Ω–∞—è  ",
    "–≠–ª–µ–≤–∞—Ç–æ—Ä—Å–∫–∞—è  ",
    "–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–æ–≤  ",
    "–≠–Ω—Ç—É–∑–∏–∞—Å—Ç–æ–≤  ",
    "–Æ–±–∏–ª–µ–π–Ω–∞—è  ",
    "–Æ–∂–Ω–∞—è  ",
    "–Ø–≥–æ–¥–Ω–∞—è  ",
    "–Ø–ª—Ç–∏–Ω—Å–∫–∞—è  ",
    "–Ø–Ω–æ–≤—Å–∫–æ–≥–æ  ",
    "–Ø–Ω—Ç–∞—Ä–Ω–∞—è   "
]

# –û–±—ä–µ–∫—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
dp = Dispatcher()

# –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
bot = Bot(token=TOKEN)

# –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã /start
@dp.message(CommandStart())
async def start_command(message: types.Message):
    keyboard = types.InlineKeyboardMarkup(inline_keyboard=[
        [types.InlineKeyboardButton(text="–ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞...", callback_data="start")]
    ])
    await message.answer("–ù–∞—á–∞—Ç—å.üîé", reply_markup=keyboard)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞..."
@dp.callback_query(F.data == "start")
async def process_start_button(callback: types.CallbackQuery):
    keyboard = types.InlineKeyboardMarkup(inline_keyboard=[
        [types.InlineKeyboardButton(text="–ü–æ–µ—Ö–∞–ª–∏ ‚û°Ô∏è", callback_data="roll")]
    ])
    await callback.message.edit_text("–ó–∞–ø—É—Å–∫ ", reply_markup=keyboard)

# –≠—Ñ—Ñ–µ–∫—Ç –ø–ª–∞–≤–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (–ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —É–ª–∏—Ü—ã)
async def simulate_roll(callback: types.CallbackQuery):
    for _ in range(10):  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        current_street = choice(STREET_LIST)
        await callback.message.edit_text(f"üîÑ –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º... \n{b(current_street)}", parse_mode='HTML')
        await asyncio.sleep(0.5)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–º–µ–Ω–æ–π —Ç–µ–∫—Å—Ç–∞
    
    final_result = choice(STREET_LIST)
    return final_result

def b(text):
    return f'<b>{text}</b>'

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–ü–æ–µ—Ö–∞–ª–∏"
@dp.callback_query(F.data == "roll")
async def roll_button_pressed(callback: types.CallbackQuery):
    final_address = await simulate_roll(callback)
    result_message = f"‚¨áÔ∏è –ë–æ–Ω—É—Å–Ω–∞—è –£–ª–∏—Ü–∞ ‚¨áÔ∏è\n\n<b>üìç –£–ª–∏—Ü–∞:</b> {final_address}\n\n  "

    # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
    result_keyboard = types.InlineKeyboardMarkup(inline_keyboard=[
        [types.InlineKeyboardButton(text="–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ üé≤ ", callback_data="repeat")]
    ])
    await callback.message.edit_text(result_message, reply_markup=result_keyboard, parse_mode='HTML')

# –ü–æ–≤—Ç–æ—Ä –∏–≥—Ä—ã
@dp.callback_query(F.data == "repeat")
async def repeat_game(callback: types.CallbackQuery):
    await start_command(callback.message)  # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å—Ü–µ–Ω–∞—Ä–∏—è —Å –Ω–∞—á–∞–ª–∞

# –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())